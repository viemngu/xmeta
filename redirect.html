<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <script>
        // Hàm giải mã AES-256-GCM
        function decryptAES256GCM(encrypted, key) {
            try {
                // Chuyển Base64 URL-safe về Base64 chuẩn
                const base64Encoded = encrypted.replace(/-/g, '+').replace(/_/g, '/');
                // Thêm padding nếu cần
                while (base64Encoded.length % 4 !== 0) {
                    base64Encoded += '=';
                }
                const buffer = Buffer.from(base64Encoded, 'base64');
                
                // Tách IV (12 byte), encrypted data, và authTag (16 byte)
                const iv = buffer.subarray(0, 12);
                const data = buffer.subarray(12, buffer.length - 16);
                const authTag = buffer.subarray(buffer.length - 16);

                // Giải mã AES-256-GCM
                const decipher = crypto.createDecipheriv('aes-256-gcm', Buffer.from(key), iv);
                decipher.setAuthTag(authTag);
                let decrypted = decipher.update(data, null, 'utf8');
                decrypted += decipher.final('utf8');
                return decrypted;
            } catch (e) {
                console.error('Decryption failed:', e);
                return null;
            }
        }

        // Lấy tham số URL từ query string
        const urlParams = new URLSearchParams(window.location.search);
        const encryptedUrl = urlParams.get('url');

        // Khóa bí mật (phải khớp với khóa dùng để mã hóa)
        const secretKey = 'MySecretKey2025!@#$';

        // Giải mã và chuyển hướng
        if (encryptedUrl) {
            const finalUrl = decryptAES256GCM(encryptedUrl, secretKey);
            if (finalUrl) {
                window.location.href = finalUrl;
            } else {
                document.body.innerText = 'Invalid or corrupted URL';
            }
        } else {
            document.body.innerText = 'No URL parameter provided';
        }
    </script>
</body>
</html>
